{% extends 'base.html.twig' %}

{% block title %}formulaire d'annonceur{% endblock %}

{% block body %}

{% block stylesheets %}
<style type="text/css">
    
    #map {
        width: 400px;
        height: 300px;
        position: none;
    }
    #search-box {
        padding-left: 20px;
        padding-top: 20px;
        width: 800px;
        height: 100px;
    }
    #result {
        padding-left: 20px;
        padding-top: 20px;
        width: 800px;
        height: 100px;
    }
    .leaflet-locationiq-results{
        padding-top: 45px;
    }
  </style>


{% endblock %}

{% block javascripts %}


{% endblock %}

<div class="example-wrapper">
    {% if app.user %}
      <h1>Hello {{ app.user.name }}</h1> 
    {% endif %}

 <h4 class = "mb-4">Cette page est le formulaire pour renseigner votre profil.</h4>

    {% for message in app.flashes('danger') %}
         <div class="alert alert-danger" role="alert">
            {{ message }}
        </div>
    {% endfor %}

    {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
    
    <div>
        {{ form_errors(form) }}
    </div>
    
    <div class="row">
    </div>

        {{ form_row(form.placeName) }}
        {{ form_row(form.description) }}
        {{ form_row(form.address_1) }}
        {{ form_row(form.address_2) }}
        {{ form_row(form.city) }}    
        {{ form_row(form.zip) }}
        {{ form_row(form.siren) }}    
        {{ form_row(form.avatar) }}
        {{ form_row(form.banner) }}
        {{ form_row(form.phone) }}
        {{ form_row(form.foundedIn) }}
        {{ form_row(form.website) }}
        {{ form_row(form.capacity) }}
        {{ form_row(form.facebook) }}
        {{ form_row(form.twitter) }}
        {{ form_row(form.instagram) }}

        <div class="col-md-4" id="some-custom-id">

            <button class="btn btn-primary">Validez votre profil annonceur</button>

        </div>
    </div>

{{ form_end(form) }}

      

</div>


<!-- For the invisible map -->
<div id="map"></div>
<!-- For the search box -->
<div id="search-box"></div>
<!-- To display the result -->
<div id="result"></div>

<!--    DOCS : 
        https://github.com/location-iq/leaflet-geocoder 
        https://locationiq.com/docs 
-->

<!-- Load Leaflet from CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.3/leaflet.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.3/leaflet.js"></script>

<!-- Load geocoding plugin after Leaflet :-->
<link rel="stylesheet" href="https://maps.locationiq.com/v2/libs/leaflet-geocoder/1.9.6/leaflet-geocoder-locationiq.min.css">
<script src="https://maps.locationiq.com/v2/libs/leaflet-geocoder/1.9.6/leaflet-geocoder-locationiq.min.js"></script>

<script type="text/javascript">

// Maps access token goes here
let key = 'pk.2da029a812df916f269b26615bf122a6';

// This is an example of Leaflet usage; you should modify this for your needs.
let  map = L.map('map').setView([40.7259, -73.9805], 12);
L.tileLayer('https://{s}-tiles.locationiq.com/v2/obk/r/{z}/{x}/{y}.png?key=pk.2da029a812df916f269b26615bf122a6').addTo(map);

let address = L.control.geocoder('pk.2da029a812df916f269b26615bf122a6',{
    params: {
      addressdetails : 1,
      countrycodes: 'IN,FR'
    }
})
.addTo(map)
.on('select', function (e) {
    //console.log(e.feature.feature.address.house_number, e.feature.feature.address.road, e.feature.feature.address.postcode,e.feature.feature.address.city, e.latlng.lat, e.latlng.lng);  //So you can see if it's working
    // add event values to variable to have each term separatly
    let lat = e.latlng.lat;
    let lng = e.latlng.lng;
    let houseNumber = e.feature.feature.address.house_number;
    let road = e.feature.feature.address.road;
    let zipCode = e.feature.feature.address.postcode;
    let city = e.feature.feature.address.city;
    
    // Contruction entire address
    let address = houseNumber + ' ' + road + ' ' + zipCode + ' ' + city;
    console.log(address);

    // Display address at the map bottom
    displayInResult = document.getElementById("result");
    console.log(displayInResult);

    displayInResult.textContent =  address ;
});



</script>



{% endblock %}
